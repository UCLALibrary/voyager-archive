# SQL Support

This `sql_support` directory is not part of the Django application, but
contains files which support the creation of the database and possibly 
loading of the data.

The application uses a legacy database, with relevant objects converted
from Oracle to PostgreSQL by [ora2pg](https://ora2pg.darold.net/documentation.html).
The Django models are then generated by `manage.py inspectdb`.  Models are all
unmanaged: they will not be used to update the database schema.  Data
will be imported using `ora2pg`.

## Create PostgreSQL objects and load sample data

From root directory of project (same directory as `docker_compose.yml`), run:
```
$ sql_support/initialize_database.sh
```

### Sample data

`sample_data.sql` contains selected data exported from the original Voyager database
by ora2pg, in a format which the PostgreSQL `psql` client can import.

The data should allow basic testing of all searches supported by the Django application's
form:
* Authority records by auth_id (`3228675`)
* Bibliographic records by bib_id (`9411434`)
* Holdings (MFHD) records by mfhd_id (`12507598`)
* Item records by item_barcode (`L0112367321`)
* Purchase orders by po_number (`EAL518017`)
* Invoices by invoice_number (`UCLA-058A`)
* Vendors by vendor_code (`YAGI`)

The sample data file also includes fund and ledger information associated with the sample invoices.

Finally, it also contains several lookup tables which are commonly used with purchase orders
and invoices:
* po_status
* po_type
* invoice_status
* item_barcode_status
* line_item_status

As additional sample data is added, update this documentation as needed.

### Loading sample data

The typical Django fixtures won't work (or are very awkward) with this legacy database.
Many of the Django models have an artificial primary key, which does not exist on the legacy tables.
This causes the normal `manage.py dumpdata` command to fail.

Since the real data is / will be loaded via `psql`, bypassing Django's ORM anyhow, the sample data 
is loaded the same way.  This is done by `sql_support/initialize_database.sh`, mentioned [above](#create-postgresql-objects-and-load-sample-data).
